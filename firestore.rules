/**
 * PORTFOLIO SECURITY RULES
 *
 * This ruleset defines access for the portfolio's top-level collections.
 * 1. Public Read: Anyone can view skills, projects, experience, and education.
 * 2. Admin Write: Only authenticated users (who have logged in via the /admin page) 
 *    can create, update, or delete content.
 */

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- HELPER FUNCTIONS ---

    function isSignedIn() {
      return request.auth != null;
    }

    // --- COLLECTION RULES ---

    // Rules for individual portfolio collections
    // These allow public viewing but restrict modifications to the admin.

    match /skills/{id} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /projects/{id} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /experience/{id} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /education/{id} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /certifications/{id} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    // Support for the legacy hierarchical structure if needed
    match /users/{userId}/portfolio/{allPaths=**} {
      allow read: if true;
      allow write: if isSignedIn() && request.auth.uid == userId;
    }
  }
}